!function(e,n){"use strict";"function"==typeof define&&define.amd?define([],function(){return e.annyang=n(e)}):"object"==typeof module&&module.exports?module.exports=n(e):e.annyang=n(e)}("undefined"!=typeof window?window:this,function(e,n){"use strict";var o,t=e.SpeechRecognition||e.webkitSpeechRecognition||e.mozSpeechRecognition||e.msSpeechRecognition||e.oSpeechRecognition;if(!t)return null;var r,i,a=[],c={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},s=0,u=!1,l="font-weight: bold; color: #00f;",f=!1,g=!1,d=/\s*\((.*?)\)\s*/g,p=/(\(\?:[^)]+\))\?/g,h=/(\(\?)?:\w+/g,m=/\*\w+/g,v=/[\-{}\[\]+?.,\\\^$|#]/g,w=function(e){return e=e.replace(v,"\\$&").replace(d,"(?:$1)?").replace(h,function(e,n){return n?e:"([^\\s]+)"}).replace(m,"(.*?)").replace(p,"\\s*$1?\\s*"),new RegExp("^"+e+"$","i")},y=function(e){var n=Array.prototype.slice.call(arguments,1);e.forEach(function(e){e.callback.apply(e.context,n)})},b=function(){return r!==n},k=function(){b()||o.init({},!1)},x=function(e,n,o){a.push({command:e,callback:n,originalPhrase:o}),u&&console.log("Command successfully loaded: %c"+o,l)},R=function(e){y(c.result,e);for(var n,o=0;o<e.length;o++){n=e[o].trim(),u&&console.log("Speech recognized: %c"+n,l);for(var t=0,r=a.length;r>t;t++){var i=a[t],s=i.command.exec(n);if(s){var f=s.slice(1);return u&&(console.log("command matched: %c"+i.originalPhrase,l),f.length&&console.log("with parameters",f)),i.callback.apply(this,f),void y(c.resultMatch,n,i.originalPhrase,e)}}}y(c.resultNoMatch,e)};return o={init:function(l,d){d=d===n?!0:!!d,r&&r.abort&&r.abort(),r=new t,r.maxAlternatives=5,r.continuous="http:"===e.location.protocol,r.lang="en-US",r.onstart=function(){g=!0,y(c.start)},r.onerror=function(e){switch(y(c.error),e.error){case"network":y(c.errorNetwork);break;case"not-allowed":case"service-not-allowed":i=!1,y((new Date).getTime()-s<200?c.errorPermissionBlocked:c.errorPermissionDenied)}},r.onend=function(){if(g=!1,y(c.end),i){var e=(new Date).getTime()-s;1e3>e?setTimeout(o.start,1e3-e):o.start()}},r.onresult=function(e){if(f)return u&&console.log("Speech heard, but annyang is paused"),!1;for(var n=e.results[e.resultIndex],o=[],t=0;t<n.length;t++)o[t]=n[t].transcript;R(o)},d&&(a=[]),l.length&&this.addCommands(l)},start:function(e){f=!1,k(),e=e||{},i=e.autoRestart!==n?!!e.autoRestart:!0,e.continuous!==n&&(r.continuous=!!e.continuous),s=(new Date).getTime();try{r.start()}catch(o){u&&console.log(o.message)}},abort:function(){i=!1,b()&&r.abort()},pause:function(){f=!0},resume:function(){o.start()},debug:function(e){u=arguments.length>0?!!e:!0},setLanguage:function(e){k(),r.lang=e},addCommands:function(n){var o;k();for(var t in n)if(n.hasOwnProperty(t))if(o=e[n[t]]||n[t],"function"==typeof o)x(w(t),o,t);else{if(!("object"==typeof o&&o.regexp instanceof RegExp)){u&&console.log("Can not register command: %c"+t,l);continue}x(new RegExp(o.regexp.source,"i"),o.callback,t)}},removeCommands:function(e){return e===n?void(a=[]):(e=Array.isArray(e)?e:[e],void(a=a.filter(function(n){for(var o=0;o<e.length;o++)if(e[o]===n.originalPhrase)return!1;return!0})))},addCallback:function(o,t,r){if(c[o]!==n){var i=e[t]||t;"function"==typeof i&&c[o].push({callback:i,context:r||this})}},removeCallback:function(e,o){var t=function(e){return e.callback!==o};for(var r in c)c.hasOwnProperty(r)&&(e!==n&&e!==r||(o===n?c[r]=[]:c[r]=c[r].filter(t)))},isListening:function(){return g&&!f},getSpeechRecognizer:function(){return r},trigger:function(e){return o.isListening()?(Array.isArray(e)||(e=[e]),void R(e)):void(u&&(g?console.log("Speech heard, but annyang is paused"):console.log("Cannot trigger while annyang is aborted")))}}});